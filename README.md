# <img src="img/wildIntel_logo.webp" alt="Wildintel Tools Logo" height="60">  wildintel-tools

![Python](https://img.shields.io/badge/python-3.11-blue.svg)
![License](https://img.shields.io/badge/license-GPLv3-blue.svg)
[![WildINTEL](https://img.shields.io/badge/WildINTEL-v1.0-blue)](https://wildintel.eu/)
[![Trapper](https://img.shields.io/badge/Trapper-Server-green)](https://gitlab.com/trapper-project/trapper)

<hr>

## Utilities for managing and validating WildIntel data

## üöÄ Features

- **Check collectionss**: Validates the names of collections and deployments within a given data directory. 
- **Check deployments**: Validates the structure and content of deployment folders within the specified collections. 
   Checks that image files exist, follow the expected chronological order, and that their timestamps are within the 
   expected start and end ranges.
- **Prepare deployments**: Prepares the directory structure required to import collections using  
   [trapper-tools](https://gitlab.com/trapper-project/trapper-tools) application. The images are resized and enriched 
   with additional XMP metadata.

## üìã Requirements

* Python 3.12 or higher  
* uv (for dependency management and packaging)  
* Typer and rich (for CLI interface)  
* dynaconf (for configuration management)
* pyexiftool (for metadata extraction)
* Docker (optional, for running in a container)
* Access to a Trapper server instance

## üß≠ Overview

WildIntel Tools is a utility suite for validating and preparing wildlife monitoring data. It ensures that collection and 
deployment folders follow standardized naming conventions, verifies that images exist and are in chronological order.

Once validated, it prepares collections for import into Trapper, flattening folder structures, resizing images, and 
embedding essential XMP metadata.

In short, WildIntel Tools streamlines the workflow from data quality control to ready-to-use datasets, keeping information 
consistent, traceable, and properly formatted for analysis.

To use wildintel-tools efficiently, start by creating a main directory named `wildintel-tools-data`.  Inside this 
directory, create two subdirectories:

* `collecions/`: this folder contains all your raw camera trap data. Organize collections 
(e.g., recording sessions or revisions) as subdirectories, and group files by deployments (e.g., individual camera locations) in 
further subfolders. Ensure these folder names match the deployment codes in your TRAPPER database, as this will be 
validated during the check-collection step.  The expected structure of multimedia files and subdirectories in the 
root (project) directory is as follows:
```
wildintel-tools-data/
‚îú‚îÄ‚îÄ collections/
‚îÇ   ‚îú‚îÄ‚îÄ collection_name_1/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deployment_id_1/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filename_1
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filename_2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deployment_id_2/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filename_1
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ filename_2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ collection_name_1_FileTimestampLog.csv
‚îÇ   ‚îú‚îÄ‚îÄ collection_name_2/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deployment_id_3/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ collection_name_2_FileTimestampLog.csv
‚îÇ   ‚îú‚îÄ‚îÄ ...
```
* `collections-ready-to-trapper/`: this folder contains collection restructured into the format expected by
[trapper-tools](https://gitlab.com/trapper-project/trapper-tools). The contents of this directory are automatically 
generated by the wildintel-tools application after the validation and enrichment process.

For each collection, you must also define a file named `collection_name_FileTimestampLog.csv`, which records the 
temporal range of data captured by each deployment. This CSV file must include the following fields:

```
Deployment,StartDate,StartTime,EndDate
```

There should be one line per deployment, indicating the start and end dates (and times) during which images were taken.
For example, `collection_name_1_FileTimestampLog.csv` could look like this:

```
Deployment,StartDate,StartTime,
deployment_id_1,2024:09:04,13:10:00,2024:11:04,14:28:00
deployment_id_2,2024:09:04,13:10:00,2024:11:04,14:28:00
```

> ‚ö†Ô∏è Important note
> 
> **Collection names** must start with the letter R followed by four digits. Examples: `R0001`, `R0234`, `R1025`.
>
> **Deployment names** must be the concatenation of the collection name and the location identifier, separated by a hyphen (-).
> For example: `R0033-DONA_0007_B`. In this case, `R0033` is the collection (revision) code and DONA_0007_B is the  
> location identifier

wildintel-tools uses TOML configuration files to manage project settings. Each project can have its own configuration. 
See [Configuration](#configuration) section for details.

## üíª Installation

wildintel-tools can be installed either using Docker or via a traditional Python virtual environment (venv). Docker 
allows you to run the application in an isolated container with all dependencies included, while using a virtual 
environment lets you install and run it directly on your system.

### Install wildintel-tools using `docker`

The easiest way to install wildintel-tools is by using the provided Docker Compose file. Follow the steps below:

#### Step 1: Install Docker
Follow the instructions for your operating system on the [Docker website](https://docs.docker.com/get-started/).

#### Step 2: Download docker-compose.yml

You can download the `docker-compose.yml` file from here or clone this repository:

```
git clone https://github.com/ijfvianauhu/wildintel-tools.git
cd wildintel-tools
```

#### Step 3: Set up a directory with your camera trap data to mount into the container

On the host machine where Docker is running, you need to have a directory containing the images you want to process. Read
[overview](#-overview) section for details on how to structure this directory.

To make this directory accessible inside the Docker container, you must set the `DATA_PATH` environment variable to this 
main directory. 

To set the values of this variable, copy the `env.example` file located in the root directory of this repository in a
`.env` file located in the same directory  as docker-compose.yml.Once copied, edit the `.env` file and update the values
of `DATA_PATH` environment variable.

```
# Linux bash
cp env.example .env

DATA_PATH=./wildintel-tools-data/
```

> **Note:** The .env file can also include your wildintel-tools global settings. See the example provided
> in this repository: env.example.

Optinally, you can also set the `DATA_PATH` environment variable directly in your shell before starting the Docker 
container:

```
# Linux bash 
export DATA_PATH=/path/to/wildintel-tools-data/
# Windows PowerShell
$env:DATA_PATH = "C:\path\to\wildintel-tools-data\"
```


#### Step 4: Start the Docker container and open a terminal inside it

```
docker compose up -d
docker compose exec --user trapper wildintel-tools bash
```
> **Note:** To update the container to the latest version, run `docker compose pull` 
> before starting it.

#### Step 5: Run trapper-tools commands

You can now run wildintel-tools commands inside the container. Refer to the [Usage section](#-usage) for available commands. For now, 
let's verify that everything is working by running:

```
wildintel-tools --help
```

You should see the following output:

```
Usage: wildintel-tools [OPTIONS] COMMAND [ARGS]...                             
                                                                                
 WildINTEL CLI Tool                                                             
                                                                                
‚ï≠‚îÄ Options ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ --version                            Show program's version number and exit  ‚îÇ
‚îÇ --verbosity                 INTEGER  Logger level: 0 (error), 1 (info), 2    ‚îÇ
‚îÇ                                      (debug).                                ‚îÇ
‚îÇ                                      [default: 1]                            ‚îÇ
‚îÇ --logfile                   PATH     Path to the log file                    ‚îÇ
‚îÇ                                      [default:                               ‚îÇ
‚îÇ                                      /root/.config/wildintel-tools/app.log]  ‚îÇ
‚îÇ --locale                    TEXT     Language code (for example, ‚Äúes‚Äù,       ‚îÇ
‚îÇ                                      ‚Äúen‚Äù). By default, the system language  ‚îÇ
‚îÇ                                      is used.                                ‚îÇ
‚îÇ                                      [default: C]                            ‚îÇ
‚îÇ --project                   TEXT     Project name for settings               ‚îÇ
‚îÇ                                      [default: default]                      ‚îÇ
‚îÇ --env-file                           Load .env file with dotenv              ‚îÇ
‚îÇ --settings-dir              PATH     Directory containing settings files     ‚îÇ
‚îÇ                                      [default:                               ‚îÇ
‚îÇ                                      /root/.config/wildintel-tools]          ‚îÇ
‚îÇ --install-completion                 Install completion for the current      ‚îÇ
‚îÇ                                      shell.                                  ‚îÇ
‚îÇ --show-completion                    Show completion for the current shell,  ‚îÇ
‚îÇ                                      to copy it or customize the             ‚îÇ
‚îÇ                                      installation.                           ‚îÇ
‚îÇ --help                               Show this message and exit.             ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
‚ï≠‚îÄ Commands ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ config      Manage project configurations                                    ‚îÇ
‚îÇ wildintel   Utilities for managing and validating WildIntel data             ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```

### Install wildintel-tools using `uv`

wildintel-tools requires several system utilities to be installed before it can be properly set up using `uv`. These utilities 
are exiftool and ffmpeg. To install them run:

```bash
# 
# Install ExifTool
sudo apt install libimage-exiftool-perl
# MAC
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
brew install exiftool
# Windows 10/11
winget install -e --id Git.Git

**Git Bash for Windows**, install using `winget`: 
```bash
# Download from https://gitforwindows.org/
# Or install using winget:
winget install -e --id Git.Git
winget install -e --id OliverBetz.ExifTool
```

Alternative manual installation:
- FFmpeg: Download from [ffmpeg.org/download.html](https://ffmpeg.org/download.html)
- ExifTool: Download from [exiftool.org](https://exiftool.org)

After installation:
1. Add FFmpeg's bin directory to your system PATH (typically `C:\Program Files\ffmpeg\bin`)
2. Add ExifTool to your system PATH (typically `C:\Program Files\exiftool`)

Once the required applications are installed, we can install `uv`:

```
# Install uv if not already installed
curl -LsSf https://astral.sh/uv/install.sh | sh
git clone https://github.com/ijfvianauhu/wildintel-tools.git
cd wildintel-tools
uv run wildintel-tools --help
```
You should see the following output:

```
Usage: wildintel-tools [OPTIONS] COMMAND [ARGS]...                                                                                            
                                                                                                                                               
 WildINTEL CLI Tool                                                                                                                            
                                                                                                                                               
‚ï≠‚îÄ Options ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ --version               --no-version             Show program's version number and exit                                                     ‚îÇ
‚îÇ --verbosity                             INTEGER  Logger level: 0 (error), 1 (info), 2 (debug).                                              ‚îÇ
‚îÇ --logfile                               PATH     Path to the log file [default: /home/ijfviana/.config/wildintel-tools/app.log]             ‚îÇ
‚îÇ --env-file                                       Load .env file with dotenv                                                                 ‚îÇ
‚îÇ --settings-dir                          PATH     Directory containing settings files [default: /home/ijfviana/.config/wildintel-tools]      ‚îÇ
‚îÇ --project                               TEXT     Project name for settings [default: default]                                               ‚îÇ
‚îÇ --install-completion                             Install completion for the current shell.                                                  ‚îÇ
‚îÇ --show-completion                                Show completion for the current shell, to copy it or customize the installation.           ‚îÇ
‚îÇ --help                                           Show this message and exit.                                                                ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
‚ï≠‚îÄ Commands ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ config      Manage project configurations                                                                                                   ‚îÇ
‚îÇ helpers     Helpers                                                                                                                         ‚îÇ
‚îÇ wildintel   Utilities for managing and validating WildIntel data                                                                            ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```


## ‚öôÔ∏è Configuration

Wildintel Tools uses [TOML](https://toml.io/en/) configuration files to manage project settings. Each project can have 
its own configuration, and every command performs strict validation, reporting missing or malformed keys with clear 
error messages. You can create multiple project configurations for different Trapper servers, projects, and settings, and 
switch between them using the `--project` flag.

To simplify the creation and management of configuration files, wildintel-tools provides the config command.

```bash
uv run wildintel-tools config --help  
                                                                                                                           
Usage: wildintel-tools config [OPTIONS] COMMAND [ARGS]...                                                                 
                                                                                                                           
Manage project configurations                                                                                             
                                                                                                                           
‚ï≠‚îÄ Options ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ --help          Show this message and exit.                                                                             ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
‚ï≠‚îÄ Commands ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ init   Initialize a new project configuration                                                                           ‚îÇ
‚îÇ show   Validate and show current project settings                                                                       ‚îÇ
‚îÇ list   List all available project configurations                                                                        ‚îÇ
‚îÇ edit   Edit settings file in default editor                                                                             ‚îÇ
‚îÇ get    Display a project setting                                                                                        ‚îÇ
‚îÇ set    Set a project setting                                                                                            ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
```

### Examples

```bash
# Create new default configuration at ~/.trapper-tools/default.toml
wildintel-tools config init 

# Create new configuration with named project
wildintel-tools --project myproject config init 

# Edit configuration file for a specific project
wildintel-tools --project myproject config edit

# Export configuration to custom location using template
wildintel-tools config init --template /path/to/template.toml

# Show configuration
wildintel-tools --project myproject config show

# List available configurations
wildintel-tools config list

# Use custom settings directory
trapper-tools --settings-dir /path/to/settings config init
```

### Configuration File Structure
TODO

## ‚ö° Usage

Once you‚Äôve [installed wildintel-tools](#install-wildintel-tools-using-uv), you can start using it 
right away from the command line. Here‚Äôs what a typical first session looks like from a user‚Äôs perspective.

> *Note*: If the installation was done using uv, it is necessary to activate the virtual environment by running 
> `source .venv/bin/activate`.

### Step 1: Configure 

First of all, initialize the configuration file by running:

```python
wildintel-tools config init
```

Once this is done, edit it and modify the environment variables (typically the `username`, `password`, `data_dir`, 
and `output_dir`) by running:

```python
wildintel-tools config edit
```

To confirm changes in the configuration file, you can run:
```
wildintel-tools config show
```

It should display something like this:

```
Settings for project 'default':

[LOGGER]
loglevel = 1
filename = 

[GENERAL]
host = https://wildintel-trap.uhu.es
login = username@uhu.es
password = mipassword
project_id = 999
verify_ssl = True
ffmpeg = ffmpeg
exiftool = exiftool
data_dir = /data/WICP_01/collections

[WILDINTEL]
rp_name = WildINTEL
coverage = Do√±ana National Park
publisher = University of Huelva
owner = University of Huelva
tolerance_hours = 1
resize_img = False
resize_img_size = [800, 600]
overwrite = False
output_dir = /data/WICP_01/collections-ready-to-trapper

```

We can find a detailed description of each configuration option in [configuraci√≥n section](#-configuration)

### Step 2: Checking configuracion

We can chck if the connection to the Trapper server is correct by running:

```
wildintel-tools helpers test-connection
```

### Step 3: check collections

After creating the configuration file and validating trapper connection, we proceed to check the names of the collections 
and deployments stored in a local folder. 

```python
wildintel-tools wildintel check-collections
```

If the data path has not been defined in the configuration file, or if you want to override the existing value, you must 
specify it explicitly using the `--data-path` option.

```python
wildintel-tools wildintel check-collections  --data-path $HOME/Download/trapper-collections/
```

If we are interesting in checking only specific collections, we can provide their names as additional arguments:

```
wildintel-tools wildintel check-collections  R0033
```

After completing the validation process, we can review any errors that occurred by running:

```
wildintel-tools reports info
```

wildintel-tools stores reports for all validation processes that have been executed.
You can list all available reports by running:

```
wildintel-tools reports list
```

If you want to display the contents of a specific report, provide its name:

```
wildintel-tools reports info report_6f72740p.yaml
```

### Step 4: check collections check deployments

Next, we will check whether the contents of each deployment are correct. The tool will verify the dates and the sequence of 
the media in each deployment based on the data provided in the field sheet ‚Äî a CSV file per collection that contains 
information about each deployment. The name of this csv file must be `<COLLECTION_NAME>_FileTimestampLog.csv`  and be 
located in the root  directory of each collection (see [section overview](#-overview).

```python
wildintel-tools wildintel check-deployments 
```

As above, we can also specify specific collections to check by providing their names as additional arguments:

```python
wildintel-tools wildintel check-deployments R0033 
```

Also, we can customize the accepted time tolerance (in hours) when comparing the first and last image timestamps against
the expected deployment start and end times using the `--tolerance-hours` option. By default, this value is set to 1 hour.

```python
wildintel-tools wildintel check-deployments R0033 --data-path $HOME/Download/trapper-collections/ --tolerance-hours 1
```

Moreover, we can limit the validation to a single deployment within a collection by using the --deployments option.

```python
wildintel-tools wildintel check-deployments R0033 --deployments roo33-dona-01 --tolerance-hours 1
```

### Step 5: prepare collections for trapper

The final step of our workflow is responsible for 'flattening' each deployment and making several modifications to each
media file. Specifically, it resizes, renames, and adds various pieces of information in XMP format.

Its basic usage is as follows:

```python
wildintel-tools wildintel prepare-for-trapper
```
When this command is executed, all collections located in `DATA_PATH` will be processed and the results will be stored
in `OUTPUT_PATH`.

If desired, you can customize these paths using the --data-path and --out-path options.

```python
wildintel-tools wildintel prepare-for-trapper  --data-path /data/collections --out-path options /data/collections-for-trapper .
```

Similar to the previous commands, we can also specify specific collections to prepare by providing their names as additional arguments:

```python
wildintel-tools wildintel prepare-for-trapper R0033 --data-path $HOME/Descargas/trapper-collections/ --output-path /tmp/trapper/
```

## ü§ù Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## üìù License

This project is licensed under the GNU General Public License v3.0 or later - see the [LICENSE](LICENSE) file for details.

This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.


## üèõÔ∏è Funding

This work is part of the [WildINTEL project](https://wildintel.eu/), funded by the Biodiversa+ Joint Research Call 2022-2023 ‚ÄúImproved
transnational monitoring of biodiversity and ecosystem change for science and society (BiodivMon)‚Äù. Biodiversa+ is the 
European co-funded biodiversity partnership supporting excellent research on biodiversity with an impact for policy and
society. Biodiversa+ is part of the European Biodiversity Strategy for 2030 that aims to put Europe‚Äôs biodiversity on a
path to recovery by 2030 and is co-funded by the European Commission. 